@page "/"
@using DomainModels
@inject Blazor.Services.APIService Api
@inject NavigationManager Nav

<section class="hero" style="@($"background-image:url('{ImgUrl("pic1.png")}');")">
    <div class="hero-inner">
        <h1>Velkommen til JoHotel</h1>
        <p>Find det perfekte ophold – elegant komfort i hjertet af byen.</p>
    </div>
</section>

<section class="section-pad container">
    <h2>Udvalgte værelser</h2>

    @if (featured is null)
    {
        <p class="muted">Henter værelser…</p>
    }
    else if (featured.Count == 0)
    {
        <p class="muted">Ingen værelser at vise.</p>
    }
    else
    {
        <div class="cards">
            @foreach (var r in featured)
            {
                var price = RoomHelpers.BasePrice(r.Type);
                var img = RoomHelpers.ImageFor(r.Type);
                var label = r.Type.DisplayName();

                <article class="room-card" key="@r.Id" style="position:relative;">
                    <div style="
                        position:absolute; left:12px; top:12px; z-index:2;
                        background:#F1E8DA; color:#3F2F22; border:1px solid #E4D8C7;
                        font-weight:700; font-size:.82rem; padding:.25rem .5rem; border-radius:8px;">
                        Fra @price.AsCurrency() / nat
                    </div>

                    <div class="room-media" style="@($"background-image:url('{ImgUrl(img)}');")"></div>
                    <div class="room-body">
                        <h3>
                            Værelse @r.RoomNumber
                            <span class="price">— @label</span>
                        </h3>

                        <p class="desc">
                            @if (r.IsAvailable)
                            {
                                <span class="badge badge-ok" title="Værelset kan bookes">Ledigt</span>
                            }
                            else
                            {
                                <span class="badge badge-no" title="Værelset er optaget">Optaget</span>
                            }
                        </p>

                        <div class="room-actions" style="display:flex; gap:.6rem; justify-content:flex-end;">
                            <a href="/rooms/@r.Id" class="details">Detaljer →</a>
                            @if (r.IsAvailable)
                            {
                                <a href="/booking?roomId=@r.Id" class="btn btn-small">Book nu</a>
                            }
                        </div>
                    </div>
                </article>
            }
        </div>
    }
</section>

@code {
    private List<RoomDto>? featured;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var all = await Api.GetRoomsOrEmptyAsync();
            featured = all.Take(3).ToList();
        }
        catch
        {
            featured = new List<RoomDto>();
        }
    }

    string ImgUrl(string file) => $"{Nav.BaseUri}{file}";
}
