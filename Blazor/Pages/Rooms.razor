@page "/rooms"
@using DomainModels
@inject Blazor.Services.APIService Api
@inject NavigationManager Nav

<section class="container">
    <h1>Værelser</h1>
    @if (loading)
    {
        <p class="muted">Henter værelser…</p>
    }
    else if (!rooms.Any())
    {
        <p class="muted">Ingen værelser.</p>
    }
    else
    {
        <div class="cards">
            @foreach (var r in rooms)
            {
                var img = RoomHelpers.ImageFor(r.Type);
                <article class="room-card">
                    <div class="room-media" style="@($"background-image:url('{ImgUrl(img)}');")"></div>
                    <div class="room-body">
                        <h3>Værelse @r.RoomNumber <span class="price">— @r.Type.DisplayName()</span></h3>
                        <p class="desc">
                            @if (r.IsAvailable)
                            {
                                <span class="badge badge-ok">Ledigt</span>
                            }
                            else
                            {
                                <span class="badge badge-no">Optaget</span>
                            }
                        </p>
                        <div class="room-actions">
                            <a href="/rooms/@r.Id" class="details">Detaljer →</a>
                            @if (r.IsAvailable)
                            {
                                <a href="/booking?roomId=@r.Id" class="btn btn-small">Book nu</a>
                            }
                        </div>
                    </div>
                </article>
            }
        </div>
    }
</section>

@code {
    private List<RoomDto> rooms = new();
    private bool loading = true;

    protected override async Task OnInitializedAsync()
    {
        try { rooms = await Api.GetRoomsAsync() ?? new(); }
        finally { loading = false; }
    }
    private string ImgUrl(string file) => $"{Nav.BaseUri}{file}";
}
